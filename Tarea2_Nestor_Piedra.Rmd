---
title: "Tarea2_Nestor_Piedra"
author: "N√©stor Piedra"
date: "2025-06-11"
output:
    html_document: 
      toc: true
      toc_float: true
      fig_width: 8
      fig_caption: true
      fig_height: 4
      df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r libraries, message=FALSE, warning=FALSE}

library(readr)
library(dplyr)
library(ggplot2)
library(caret)
library(corrplot)

```

# üìà M√©todos de Regresi√≥n

## Tarea 2. Consumo El√©ctrico

El consumo el√©ctrico dom√©stico es un indicador clave para la planificaci√≥n de infraestructura energ√©tica. Este an√°lisis busca modelar y predecir el comportamiento del consumo activo a partir de variables t√©cnicas registradas minuto a minuto, con el fin de identificar patrones de demanda y generar recomendaciones aplicables a horas pico.

Una incorrecta planeaci√≥n del consumo el√©ctrico seg√∫n las fuentes de energ√≠a que se tengan en un pa√≠s puede desencadenar inconvenientes, como el reciente apag√≥n masivo en la pen√≠nsula ib√©rica, causado presuntamente por un incorrecto an√°lisis del consumo y una dependencia de las energ√≠as renovables las cuales no brindan tanta constancia ni consistencia como otros m√©todos de generaci√≥n.

### üìä Carga de los datos

```{r data_load, message=FALSE, warning=FALSE}

# Carga de los datos y verificaci√≥n

datos <- read.csv("consumo_electrico_domestico.csv", sep =";", dec = ".", header=TRUE, stringsAsFactors = TRUE)
head(datos)

sum(!is.na(datos))
summary(datos)

```
Pueden observarse bastantes NA en el conjunto de datos.Por lo que se realizar√° una limpieza de los mismos previo a su an√°lisis, as√≠ mismo debido a la naturaleza de los datos, para que el modelo tome la menor cantidad de tiempo posible manteniendo informaci√≥n relevante, se limitar√° el estudio a √∫nicamente un a√±o (2010 por ser el m√°s reciente) para optimizar el rendimiento.

```{r ETL, message=FALSE, warning=FALSE}

# Convertir fecha y filtrar solo un a√±o 
datos$FechaHora <- as.POSIXct(paste(datos$Fecha, datos$Hora), format="%d/%m/%Y %H:%M:%S")
datos$Anno <- format(datos$FechaHora, "%Y")

datos_2010 <- datos %>% filter(Anno == "2010")

# Eliminaci√≥n de las columnas irrelevantes y NA
datos_modelo <- datos_2010 %>% na.omit() %>% select(-Fecha, -Hora, -FechaHora, -Anno) 
```

Con los datos limpios, puede procederse con el modelo de regresi√≥n lineal. En este escenario se crea un modelo utilizando las variables disponibles (Excepto Energia_activa_global).

### üìà  Modelo de Regresi√≥n Lineal

```{r LM, message=FALSE, warning=FALSE}

# Modelo completo
modelo_lm <- lm(Energia_activa_global ~ ., data = datos_modelo)
summary(modelo_lm)

```

De acuerdo con el summary de los datos, todas las variables independientes cuentan con suficiente distinci√≥n para ser buenas variables predictoras.Por lo que utilizaremos todas las variables para este trabajo.

### üèã Entrenamiento de un nuevo modelo de predicci√≥n y correlaci√≥n

```{r MPL, message=FALSE, warning=FALSE}

tam<-dim(datos_modelo)
n<-tam[1]
muestra <- sample(1:n,floor(n*0.33))

ttesting <- datos_modelo[muestra,]
taprendizaje <- datos_modelo[-muestra,]

modelo <- lm(Energia_activa_global ~ ., data = taprendizaje) # Todas las variables presentaron *** por lo que se utilizan todas

# Predicci√≥n
y_predict <- predict(modelo, taprendizaje)

```

Una vez realizada la predicci√≥n se genera la correlaci√≥n:

```{r corr, message=FALSE, warning=FALSE}

# Correlaci√≥n entre predicci√≥n y valores reales
correlacion <- cor(y_predict, taprendizaje$Energia_activa_global)
correlacion

```

El modelo muestra un R¬≤ de 0.999, lo que indica un ajuste casi perfecto.


### ‚ö° Energ√≠a en 2020

```{r data_load_2020, message=FALSE, warning=FALSE}

# Carga de los datos y verificaci√≥n

datos_2020 <- read.csv("consumo_electrico_domestico2020.csv", sep =";", dec = ".", header=TRUE, stringsAsFactors = TRUE)
head(datos_2020)

sum(!is.na(datos_2020))
summary(datos_2020)

```

```{r predict_2020, message=FALSE, warning=FALSE}

datos_2020$Energia_activa_global <- predict(modelo, newdata = datos_2020)
head(datos_2020)

```


Una vez generados los valores de energ√≠a mediante el modelo predictivo, podemos encontrar el d√≠a y la hora con mayor consumo, tal que

```{r consumption, message=FALSE, warning=FALSE}

datos$DiaSemana <- weekdays(datos$FechaHora)
datos$Hora <- format(datos$FechaHora, "%H:00")

consumo_horario <- datos %>%
  group_by(DiaSemana, Hora) %>%
  summarise(Media = mean(Energia_activa_global, na.rm = TRUE)) %>%
  arrange(desc(Media))

head(consumo_horario, 1)

```

Con esta informaci√≥n sabemos que el pico de consumo se da el d√≠a domingo alrededor de las 8:00 p.m, de manera que puede crearse un modelo para predecir el consumo en horas pico de la red el√©ctrica.

```{r peak_consumption, message=FALSE, warning=FALSE}

datos_pico <- datos %>% 
  filter(weekdays(FechaHora) == "domingo", format(FechaHora, "%H") == "20") %>%
  select(Energia_activa_global, Energia_reactiva_global) %>%
  na.omit()

modelo_pico <- lm(Energia_activa_global ~ Energia_reactiva_global, data = datos_pico)

# Simulacion 30 nuevos valores de x
set.seed(123)
simulacion <- data.frame(Energia_reactiva_global = runif(30, 
                                        min = min(datos_pico$Energia_reactiva_global), 
                                        max = max(datos_pico$Energia_reactiva_global)))

simulacion$Energia_activa_prediccion <- predict(modelo_pico, newdata = simulacion)

ggplot() +
  geom_point(data = datos_pico, aes(x = Energia_reactiva_global, y = Energia_activa_global), color = "darkgreen", alpha = 0.6, size = 2) +
  geom_point(data = simulacion, aes(x = Energia_reactiva_global, y = Energia_activa_prediccion), color = "orange", shape = 17, size = 2.5) +
  geom_smooth(data = datos_pico, aes(x = Energia_reactiva_global, y = Energia_activa_global), method = "lm", se = FALSE, color = "midnightblue", size = 1) +
  labs(title = "Comparaci√≥n entre valores reales y simulados",
    subtitle = "Energ√≠a activa global vs. Energ√≠a reactiva global",
    x = "Energ√≠a Reactiva Global (kVARh)",
    y = "Energ√≠a Activa Global (kWh)",
    caption = "Puntos verdes: valores reales | Naranjas: simulados | L√≠nea azul: tendencia"
  ) +
  theme_minimal(base_size = 13)

```

### üìå Conclusiones

- El modelo logra predecir el consumo el√©ctrico con alta precisi√≥n (correlaci√≥n 0.999).
- El mayor consumo se presenta los domingos a las 8:00 p.m., lo cual indica una posible saturaci√≥n de la red en ese horario.
- Este tipo de modelo podr√≠a ayudar a mejorar la gesti√≥n de la demanda el√©ctrica en zonas residenciales.

Como mejora futura, podr√≠an incorporarse todos los a√±os al an√°lisis para un mejor modelo de predicci√≥n.

